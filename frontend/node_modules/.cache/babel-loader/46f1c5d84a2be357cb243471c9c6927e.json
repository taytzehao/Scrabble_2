{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\TzeHaoTay\\\\Desktop\\\\CS\\\\scrabble2\\\\frontend\\\\src\\\\Games_page\\\\Gamespage.js\",\n    _s = $RefreshSig$();\n\nimport './Gamespage.css';\nimport React, { useState, useContext, useEffect, useRef, useMemo } from 'react';\nimport axios from 'axios';\nimport Popup from 'reactjs-popup';\nimport { SocketContext, UserContext } from '../UserContext.js';\nimport { Player } from './Player.js';\nimport { Link, useParams } from 'react-router-dom';\nimport io from 'socket.io-client';\nimport Joingame from './Main_game/Joingame.js';\nimport Action_bar from './Action/Actionbar.js';\nimport Alphabet_analytics from './Alphabet_analytics/Alphabet_analytics.js';\nimport Main_game from './Main_game/Main_game.js';\nimport Sachet, { analytics_data } from './Sachet.js';\nimport { GamesContext, BlocksContext, PlayerListContext, AnalyticsDataContext, SachetContext } from './GamesContext.js';\nimport { Blocks } from './Main_game/Board.js';\nimport _ from \"lodash\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Gamespage() {\n  _s();\n\n  const {\n    profile,\n    setprofile\n  } = useContext(UserContext);\n  const websocket = useContext(SocketContext);\n  const [boardState, setboardState] = useState(new Blocks());\n  const [renderAction, setrenderAction] = useState(false);\n  const [gameState, setgameState] = useState({\n    room_id: useParams().room_id,\n    gamestarted: false,\n    turn_num: 0,\n    player_turn: 0,\n    player_num: 0,\n    your_index: 0,\n    skip_indexes: [],\n    challenge_index: undefined,\n    challenge_words: [],\n    endgame: false,\n    just_added: []\n  });\n  const [playerlistState, setplayerlistState] = useState([]);\n  const [analyticsdataState, setanalyticsdataState] = useState(analytics_data);\n  const [sachetState, setsachetState] = useState(new Sachet());\n  const playerlistRef = useRef(null);\n  const gamestateRef = useRef(null);\n  const boardstateRef = useRef(null);\n  const sachetstateRef = useRef(null);\n  playerlistRef.current = playerlistState;\n  gamestateRef.current = gameState;\n  boardstateRef.current = boardState;\n  sachetstateRef.current = sachetState;\n  useEffect(() => {\n    axios.get('http://localhost:5500/get_added_players', {\n      params: {\n        room_id: gameState.room_id,\n        username: profile.username\n      }\n    }).then(res => {\n      let sachet = { ...sachetstateRef.current\n      };\n      Object.setPrototypeOf(sachet, sachetstateRef.current);\n      let temp_player_list = [];\n\n      for (let i = 0; i < res.data.length; i++) {\n        let temp_player = new Player(res.data[i].Username);\n        temp_player.draw_by_tiles(res.data[i].Tiles);\n        sachet.remove_by_tiles(res.data[i].Tiles);\n        temp_player_list.push(temp_player);\n      }\n\n      const your_player = new Player(profile.username, true);\n      let drawn_tiles = your_player.draw(sachet);\n      your_player.tiles = drawn_tiles;\n      axios.put(\"http://localhost:5500/add_player\", {\n        username: your_player.username,\n        tiles: drawn_tiles,\n        room_id: gamestateRef.current.room_id\n      });\n      temp_player_list.push(your_player);\n      websocket.current.emit(\"emit_new_player\", {\n        username: your_player.username,\n        tiles: your_player.tiles,\n        room_id: gamestateRef.current.room_id\n      });\n      websocket.current.on(\"incoming_new_player\", res => {\n        let sachet2 = { ...sachetstateRef\n        };\n        Object.setPrototypeOf(sachet2, sachetstateRef.current);\n        console.log(\"INCOMING NEW PLAYER\", res);\n        let temp_player = new Player(res.username);\n        temp_player.draw_by_tiles(res.tiles);\n        sachet2.remove_by_tiles(res.tiles);\n        let lis = [...playerlistRef.current, temp_player];\n        console.log(\"TEMP PLAYER\", lis);\n        setplayerlistState(lis);\n        setgameState(prevgamestate => ({ ...prevgamestate,\n          player_num: prevgamestate.player_num + 1\n        }));\n        setsachetState(sachet2);\n      });\n      setgameState(prevgamestate => ({ ...prevgamestate,\n        player_num: prevgamestate.player_num + temp_player_list.length,\n        your_index: temp_player_list.length - 1,\n        player_turn: prevgamestate.turn_num % (prevgamestate.player_num + temp_player_list.length)\n      }));\n      setplayerlistState(prevplayerlist => [...prevplayerlist, ...temp_player_list]);\n      setsachetState(sachet);\n      setrenderAction(true);\n    });\n  }, []);\n  useEffect(() => {\n    setgameState(prevgamestate => ({ ...prevgamestate,\n      player_turn: prevgamestate.turn_num % prevgamestate.player_num\n    }));\n  }, [, gameState.turn_num]);\n  useEffect(() => {\n    if (gamestateRef.current.skip_indexes.includes(gamestateRef.current.player_turn)) {\n      setgameState(prevgamestate => ({ ...prevgamestate,\n        turn_num: prevgamestate.turn_num + 1,\n        skip_indexes: prevgamestate.skip_indexes.filter(index => index != prevgamestate.player_turn)\n      }));\n    } else {\n      setplayerlistState(prevplayerlist => {\n        let newplayerlist = [...prevplayerlist];\n\n        for (let i = 0; i < newplayerlist.length; i++) {\n          i == gameState.player_turn ? newplayerlist.active = true : newplayerlist.active = false;\n        }\n\n        return newplayerlist;\n      });\n    }\n  }, [gamestateRef.current.player_turn]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Games_page\",\n    children: [/*#__PURE__*/_jsxDEV(Joingame, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(SachetContext.Provider, {\n      value: {\n        sachetState,\n        setsachetState\n      },\n      children: /*#__PURE__*/_jsxDEV(AnalyticsDataContext.Provider, {\n        value: {\n          analyticsdataState,\n          setanalyticsdataState\n        },\n        children: /*#__PURE__*/_jsxDEV(GamesContext.Provider, {\n          value: {\n            gameState,\n            setgameState\n          },\n          children: /*#__PURE__*/_jsxDEV(PlayerListContext.Provider, {\n            value: {\n              playerlistState,\n              setplayerlistState\n            },\n            children: /*#__PURE__*/_jsxDEV(BlocksContext.Provider, {\n              value: {\n                boardState,\n                setboardState\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Main_divider\",\n                children: [/*#__PURE__*/_jsxDEV(Alphabet_analytics, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 141,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(Main_game, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 142,\n                  columnNumber: 25\n                }, this), renderAction && /*#__PURE__*/_jsxDEV(Action_bar, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 143,\n                  columnNumber: 42\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 140,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Gamespage, \"/ZpU9nT9HZMGpF5AUrZjw6qUMts=\", false, function () {\n  return [useParams];\n});\n\n_c = Gamespage;\nexport default Gamespage;\n\nvar _c;\n\n$RefreshReg$(_c, \"Gamespage\");","map":{"version":3,"sources":["C:/Users/TzeHaoTay/Desktop/CS/scrabble2/frontend/src/Games_page/Gamespage.js"],"names":["React","useState","useContext","useEffect","useRef","useMemo","axios","Popup","SocketContext","UserContext","Player","Link","useParams","io","Joingame","Action_bar","Alphabet_analytics","Main_game","Sachet","analytics_data","GamesContext","BlocksContext","PlayerListContext","AnalyticsDataContext","SachetContext","Blocks","_","Gamespage","profile","setprofile","websocket","boardState","setboardState","renderAction","setrenderAction","gameState","setgameState","room_id","gamestarted","turn_num","player_turn","player_num","your_index","skip_indexes","challenge_index","undefined","challenge_words","endgame","just_added","playerlistState","setplayerlistState","analyticsdataState","setanalyticsdataState","sachetState","setsachetState","playerlistRef","gamestateRef","boardstateRef","sachetstateRef","current","get","params","username","then","res","sachet","Object","setPrototypeOf","temp_player_list","i","data","length","temp_player","Username","draw_by_tiles","Tiles","remove_by_tiles","push","your_player","drawn_tiles","draw","tiles","put","emit","on","sachet2","console","log","lis","prevgamestate","prevplayerlist","includes","filter","index","newplayerlist","active"],"mappings":"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","sourcesContent":["import './Gamespage.css';\r\nimport React, {useState,useContext,useEffect,useRef,useMemo} from 'react';\r\nimport axios from 'axios';\r\nimport Popup from 'reactjs-popup';\r\nimport {SocketContext, UserContext} from '../UserContext.js';\r\nimport {Player} from './Player.js'\r\nimport {Link,useParams} from 'react-router-dom';\r\nimport io from 'socket.io-client';\r\nimport Joingame from './Main_game/Joingame.js'\r\nimport Action_bar from './Action/Actionbar.js'\r\nimport Alphabet_analytics from './Alphabet_analytics/Alphabet_analytics.js'\r\nimport Main_game from './Main_game/Main_game.js' \r\nimport Sachet, { analytics_data } from './Sachet.js'\r\nimport {GamesContext,BlocksContext,PlayerListContext,AnalyticsDataContext,SachetContext} from './GamesContext.js'\r\nimport {Blocks} from './Main_game/Board.js'\r\nimport _ from \"lodash\";\r\n\r\nfunction Gamespage() {\r\n    const {profile,setprofile}=useContext(UserContext)\r\n    const websocket=useContext(SocketContext)\r\n    const [boardState,setboardState]=useState(new Blocks())\r\n    const [renderAction,setrenderAction]=useState(false)\r\n    const [gameState,setgameState]=useState({\r\n      room_id:useParams().room_id,\r\n      gamestarted:false,\r\n      turn_num:0,\r\n      player_turn:0,\r\n      player_num:0, \r\n      your_index:0,\r\n      skip_indexes:[],\r\n      challenge_index:undefined,\r\n      challenge_words:[],\r\n      endgame:false,\r\n      just_added:[]\r\n    })\r\n    const [playerlistState,setplayerlistState]=useState([])\r\n    const [analyticsdataState,setanalyticsdataState]=useState(analytics_data)\r\n    const [sachetState,setsachetState]=useState(new Sachet())\r\n    const playerlistRef=useRef(null);\r\n    const gamestateRef=useRef(null);\r\n    const boardstateRef=useRef(null);\r\n    const sachetstateRef=useRef(null);\r\n    playerlistRef.current=playerlistState\r\n    gamestateRef.current=gameState\r\n    boardstateRef.current=boardState\r\n    sachetstateRef.current=sachetState\r\n    useEffect(()=>{\r\n      \r\n      axios.get('http://localhost:5500/get_added_players',{params: {room_id:gameState.room_id,username:profile.username}}).then((res)=>{\r\n        let sachet={...sachetstateRef.current}\r\n        Object.setPrototypeOf( sachet,sachetstateRef.current )\r\n\r\n        let temp_player_list=[]\r\n        for (let i=0;i<res.data.length;i++){\r\n          let temp_player=new Player(res.data[i].Username)\r\n          temp_player.draw_by_tiles(res.data[i].Tiles)\r\n          sachet.remove_by_tiles(res.data[i].Tiles)\r\n          temp_player_list.push(temp_player)\r\n        }\r\n\r\n        const your_player=new Player(profile.username,true)\r\n        let drawn_tiles=your_player.draw(sachet)\r\n        your_player.tiles=drawn_tiles\r\n        axios.put(\"http://localhost:5500/add_player\",{\r\n          username:your_player.username,\r\n          tiles:drawn_tiles,\r\n          room_id:gamestateRef.current.room_id\r\n        })\r\n        temp_player_list.push(your_player)\r\n        \r\n        \r\n        websocket.current.emit(\"emit_new_player\",{\r\n          username:your_player.username,\r\n          tiles:your_player.tiles,\r\n          room_id:gamestateRef.current.room_id})\r\n        \r\n        websocket.current.on(\"incoming_new_player\", (res)=>{\r\n          let sachet2={...sachetstateRef}\r\n          Object.setPrototypeOf( sachet2,sachetstateRef.current )\r\n          console.log(\"INCOMING NEW PLAYER\",res)\r\n          let temp_player=new Player(res.username)\r\n          temp_player.draw_by_tiles(res.tiles)\r\n          sachet2.remove_by_tiles(res.tiles)\r\n          \r\n          let lis=[...playerlistRef.current,temp_player]\r\n          console.log(\"TEMP PLAYER\",lis)\r\n\r\n          setplayerlistState(lis)\r\n          setgameState(prevgamestate=>({...prevgamestate,\r\n            player_num: prevgamestate.player_num+1\r\n          }))\r\n          setsachetState(sachet2)\r\n        })\r\n        \r\n        setgameState(prevgamestate=>({...prevgamestate,\r\n          player_num: prevgamestate.player_num+temp_player_list.length,\r\n          your_index:temp_player_list.length-1,\r\n          player_turn:prevgamestate.turn_num%(prevgamestate.player_num+temp_player_list.length)\r\n        }))\r\n        \r\n        setplayerlistState(prevplayerlist=>[...prevplayerlist,...temp_player_list])\r\n        setsachetState(sachet)\r\n        setrenderAction(true)\r\n        \r\n    \r\n    })},[])\r\n\r\n    useEffect(()=>{\r\n      setgameState( prevgamestate=>({...prevgamestate,\r\n      player_turn:prevgamestate.turn_num%prevgamestate.player_num\r\n    }))}\r\n    ,[,gameState.turn_num])\r\n    \r\n    useEffect(()=>{\r\n      if (gamestateRef.current.skip_indexes.includes(gamestateRef.current.player_turn)){\r\n        setgameState(prevgamestate=>({...prevgamestate,\r\n          turn_num:prevgamestate.turn_num+1,\r\n          skip_indexes:prevgamestate.skip_indexes.filter(index=>index!=prevgamestate.player_turn)\r\n        }))\r\n      }else{\r\n      setplayerlistState(prevplayerlist=>{\r\n        let newplayerlist=[...prevplayerlist]\r\n        for (let i=0;i<newplayerlist.length;i++){\r\n          (i==gameState.player_turn) ? newplayerlist.active=true : newplayerlist.active=false\r\n        }\r\n        return newplayerlist\r\n    })}}\r\n    ,[gamestateRef.current.player_turn])\r\n\r\n    \r\n    \r\n      return (     \r\n        <div className=\"Games_page\">\r\n            <Joingame/>\r\n            <SachetContext.Provider value={{sachetState,setsachetState}}>\r\n              <AnalyticsDataContext.Provider value={{analyticsdataState,setanalyticsdataState}}>\r\n                <GamesContext.Provider value={{gameState,setgameState}}>\r\n                  <PlayerListContext.Provider value={{playerlistState,setplayerlistState}}>\r\n                    <BlocksContext.Provider value={{boardState,setboardState}}>\r\n                      <div className=\"Main_divider\">\r\n                        <Alphabet_analytics />\r\n                        <Main_game />\r\n                        {renderAction && <Action_bar />}\r\n                      </div> \r\n                    </BlocksContext.Provider>\r\n                  </PlayerListContext.Provider>   \r\n                </GamesContext.Provider>   \r\n              </AnalyticsDataContext.Provider>  \r\n              </SachetContext.Provider>                \r\n        </div>\r\n      );\r\n  }\r\n\r\n  \r\nexport default Gamespage;"]},"metadata":{},"sourceType":"module"}