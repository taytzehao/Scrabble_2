{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\TzeHaoTay\\\\Desktop\\\\CS\\\\scrabble2\\\\frontend\\\\src\\\\Games_page\\\\Action\\\\Draw_button.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useContext, useEffect, useRef } from 'react';\nimport { UserContext, SocketContext } from '../../UserContext.js';\nimport { GamesContext, BlocksContext, PlayerListContext, SachetContext } from '../GamesContext.js';\nimport { games_sachet } from '../Gamespage.js';\nimport './Actionbar.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Draw_button(values) {\n  _s();\n\n  const [drawActive, setdrawActive] = useState(false);\n  const websocket = useContext(SocketContext);\n  const {\n    profile,\n    setprofile\n  } = useContext(UserContext);\n  const {\n    playerlistState,\n    setplayerlistState\n  } = useContext(PlayerListContext);\n  const {\n    gameState,\n    setgameState\n  } = useContext(GamesContext);\n  const {\n    sachetState,\n    setsachetState\n  } = useContext(SachetContext);\n  const playerlistRef = useRef(null);\n  const gamestateRef = useRef(null);\n  const sachetstateRef = useRef(null);\n  playerlistRef.current = playerlistState;\n  gamestateRef.current = gameState;\n  sachetstateRef.current = sachetState;\n  const drawstyle = {\n    opacity: drawActive ? 1 : 0.5\n  };\n\n  function Draw() {\n    let sachet = { ...sachetstateRef.current\n    };\n    Object.setPrototypeOf(sachet, sachetstateRef.current);\n    var drawn_tiles = playerlistRef.current[gamestateRef.current.player_turn].draw(sachet);\n    let return_tiles = playerlistRef.current[gamestateRef.current.player_turn].delete_list;\n\n    for (let i = 0; i < return_tiles.length; i++) {\n      return_tiles[i].canDrop = false;\n      return_tiles[i].canDrag = false;\n      return_tiles[i].container_index = undefined;\n      return_tiles[i].board_index = undefined;\n      return_tiles[i].placed = false;\n      return_tiles[i].just_added = false;\n    }\n\n    console.log(\"DRAWN TILES\", drawn_tiles);\n    sachet.add_by_tiles(return_tiles);\n    let tempdeletelist = playerlistRef.current[gamestateRef.current.player_turn].delete_list;\n    let tempplayer = playerlistRef.current[gamestateRef.current.player_turn];\n    temp;\n    setplayerlistState(prevplayerlist => {\n      let newplayerlist = [...prevplayerlist];\n      newplayerlist[gamestateRef.current.player_turn].tiles = newplayerlist[gamestateRef.current.player_turn].tiles.concat(drawn_tiles);\n      newplayerlist[gamestateRef.current.player_turn].delete_list = [];\n      return newplayerlist;\n    });\n    values.next_funct(sachet);\n\n    for (let i = 0; i < drawn_tiles.length; i++) {\n      drawn_tiles[i].canDrop = false;\n      drawn_tiles[i].canDrag = false;\n    }\n\n    websocket.current.emit(\"emit_draw\", {\n      room_id: gamestateRef.current.room_id,\n      player_turn: gamestateRef.current.player_turn,\n      drawn_tiles: drawn_tiles,\n      return_tiles: tempdeletelist\n    });\n  }\n\n  useEffect(() => {\n    console.log(\"WEBSOCKET ONE\", websocket.current);\n    websocket.current.on(\"update_player_draw\", socket_out => {\n      let sachet2 = { ...sachetstateRef.current\n      };\n      Object.setPrototypeOf(sachet2, sachetstateRef.current);\n      sachet2.add_by_tiles(socket_out.return_tiles);\n      sachet2.remove_by_tiles(socket_out.drawn_tiles);\n      setplayerlistState(prevplayerlist => {\n        let newplayerlist = [...prevplayerlist];\n        newplayerlist[gamestateRef.current.player_turn].draw_by_tiles(socket_out.drawn_tiles);\n        newplayerlist[gamestateRef.current.player_turn].delete_list = [];\n        return newplayerlist;\n      });\n      values.next_funct(sachet2);\n    });\n  }, []);\n  useEffect(() => {\n    if (gamestateRef.current.player_turn == gamestateRef.current.your_index && !gamestateRef.current.just_added.length && playerlistState[gameState.your_index].delete_list.length) {\n      setdrawActive(true);\n    } else {\n      setdrawActive(false);\n    }\n  }, [, gameState, playerlistState]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      className: \"draw_button gamesbtn\",\n      style: drawstyle,\n      onClick: Draw,\n      disabled: !drawActive,\n      children: \"Draw\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Draw_button, \"LRu4pyh7eahKoKWDNvjPDQSwRZk=\");\n\n_c = Draw_button;\nexport default Draw_button;\n\nvar _c;\n\n$RefreshReg$(_c, \"Draw_button\");","map":{"version":3,"sources":["C:/Users/TzeHaoTay/Desktop/CS/scrabble2/frontend/src/Games_page/Action/Draw_button.js"],"names":["React","useState","useContext","useEffect","useRef","UserContext","SocketContext","GamesContext","BlocksContext","PlayerListContext","SachetContext","games_sachet","Draw_button","values","drawActive","setdrawActive","websocket","profile","setprofile","playerlistState","setplayerlistState","gameState","setgameState","sachetState","setsachetState","playerlistRef","gamestateRef","sachetstateRef","current","drawstyle","opacity","Draw","sachet","Object","setPrototypeOf","drawn_tiles","player_turn","draw","return_tiles","delete_list","i","length","canDrop","canDrag","container_index","undefined","board_index","placed","just_added","console","log","add_by_tiles","tempdeletelist","tempplayer","temp","prevplayerlist","newplayerlist","tiles","concat","next_funct","emit","room_id","on","socket_out","sachet2","remove_by_tiles","draw_by_tiles","your_index"],"mappings":"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","sourcesContent":["import React, {useState,useContext,useEffect,useRef} from 'react';\r\nimport {UserContext,SocketContext} from '../../UserContext.js'\r\nimport {GamesContext,BlocksContext,PlayerListContext,SachetContext} from '../GamesContext.js'\r\nimport {games_sachet} from '../Gamespage.js'\r\nimport './Actionbar.css'\r\n\r\nfunction Draw_button(values){\r\n    const [drawActive,setdrawActive]=useState(false) \r\n    const websocket=useContext(SocketContext)\r\n    const {profile,setprofile}=useContext(UserContext)\r\n    const {playerlistState,setplayerlistState}=useContext(PlayerListContext)\r\n    const {gameState,setgameState}=useContext(GamesContext)   \r\n    const {sachetState,setsachetState}=useContext(SachetContext)   \r\n    const playerlistRef=useRef(null);\r\n    const gamestateRef=useRef(null);\r\n    const sachetstateRef=useRef(null);\r\n    playerlistRef.current=playerlistState\r\n    gamestateRef.current=gameState\r\n    sachetstateRef.current=sachetState\r\n    \r\n    const drawstyle={opacity:(drawActive) ?  1: 0.5 }\r\n\r\n\r\n    function Draw(){\r\n      let sachet={...sachetstateRef.current}\r\n      Object.setPrototypeOf( sachet,sachetstateRef.current )\r\n      var drawn_tiles=playerlistRef.current[gamestateRef.current.player_turn].draw(sachet)\r\n      let return_tiles=playerlistRef.current[gamestateRef.current.player_turn].delete_list\r\n      for (let i=0;i<return_tiles.length;i++){\r\n        return_tiles[i].canDrop=false\r\n        return_tiles[i].canDrag=false\r\n        return_tiles[i].container_index=undefined\r\n        return_tiles[i].board_index=undefined\r\n        return_tiles[i].placed=false\r\n        return_tiles[i].just_added=false\r\n      }\r\n      console.log(\"DRAWN TILES\",drawn_tiles)\r\n      \r\n      sachet.add_by_tiles(return_tiles)\r\n      let tempdeletelist=playerlistRef.current[gamestateRef.current.player_turn].delete_list\r\n      let tempplayer=playerlistRef.current[gamestateRef.current.player_turn]\r\n      temp\r\n      setplayerlistState((prevplayerlist=>{\r\n        let newplayerlist=[...prevplayerlist]\r\n        newplayerlist[gamestateRef.current.player_turn].tiles=newplayerlist[gamestateRef.current.player_turn].tiles.concat(drawn_tiles)\r\n        newplayerlist[gamestateRef.current.player_turn].delete_list=[]\r\n        return newplayerlist\r\n      }))\r\n     \r\n      values.next_funct(sachet)\r\n      for (let i=0;i<drawn_tiles.length;i++){\r\n        drawn_tiles[i].canDrop=false\r\n        drawn_tiles[i].canDrag=false\r\n      }\r\n      websocket.current.emit(\"emit_draw\",{  \r\n        room_id:gamestateRef.current.room_id,\r\n        player_turn:gamestateRef.current.player_turn,\r\n        drawn_tiles:drawn_tiles,\r\n        return_tiles:tempdeletelist\r\n      })\r\n      }\r\n      useEffect(()=>{\r\n        console.log(\"WEBSOCKET ONE\",websocket.current)\r\n        \r\n        websocket.current.on(\"update_player_draw\",(socket_out)=>{\r\n          let sachet2={...sachetstateRef.current}\r\n          Object.setPrototypeOf( sachet2,sachetstateRef.current )\r\n          sachet2.add_by_tiles(socket_out.return_tiles)\r\n          sachet2.remove_by_tiles(socket_out.drawn_tiles)\r\n          setplayerlistState((prevplayerlist=>{\r\n            let newplayerlist=[...prevplayerlist]\r\n            newplayerlist[gamestateRef.current.player_turn].draw_by_tiles(socket_out.drawn_tiles)\r\n            newplayerlist[gamestateRef.current.player_turn].delete_list=[]\r\n            return newplayerlist\r\n          }))\r\n        values.next_funct(sachet2)\r\n      })},[])\r\n\r\n    useEffect(()=>{\r\n     \r\n        if(gamestateRef.current.player_turn==gamestateRef.current.your_index && \r\n          !gamestateRef.current.just_added.length && \r\n          playerlistState[gameState.your_index].delete_list.length){\r\n        \r\n          setdrawActive(true)\r\n        }else{\r\n         \r\n          setdrawActive(false)\r\n        }\r\n      },[,gameState,playerlistState])\r\n\r\n    return(\r\n        <div>\r\n            <button type=\"button\" className=\"draw_button gamesbtn\" style={drawstyle} onClick={Draw} disabled={!drawActive}>Draw</button> \r\n        </div>)\r\n}\r\n\r\nexport default Draw_button"]},"metadata":{},"sourceType":"module"}