{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\TzeHaoTay\\\\Desktop\\\\CS\\\\scrabble2\\\\frontend\\\\src\\\\Games_page\\\\Gamespage.js\",\n    _s = $RefreshSig$();\n\nimport './Gamespage.css';\nimport React, { useState, useContext, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport Popup from 'reactjs-popup';\nimport { UserContext } from '../UserContext.js';\nimport { Player } from './Player.js';\nimport { Link, useParams } from 'react-router-dom';\nimport io from 'socket.io-client';\nimport Joingame from './Main_game/Joingame.js';\nimport Action_bar from './Action/Actionbar.js';\nimport Alphabet_analytics from './Alphabet_analytics/Alphabet_analytics.js';\nimport Main_game from './Main_game/Main_game.js';\nimport Sachet, { analytics_data } from './Sachet.js';\nimport { GamesContext, BlocksContext, PlayerListContext, AnalyticsDataContext, SachetContext } from './GamesContext.js';\nimport { Blocks } from './Main_game/Board.js';\nimport _ from \"lodash\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Gamespage() {\n  _s();\n\n  const {\n    profile,\n    setprofile\n  } = useContext(UserContext);\n  const socketRef = useRef();\n  socketRef.current = io(\"http://localhost:5500\").connect(); //.connect(\"http://localhost:5500\")\n\n  const [boardState, setboardState] = useState(new Blocks());\n  const [renderAction, setrenderAction] = useState(false);\n  const [gameState, setgameState] = useState({\n    room_id: useParams().room_id,\n    gamestarted: false,\n    socket: socketRef,\n    turn_num: 0,\n    player_turn: 0,\n    player_num: 0,\n    your_index: 0,\n    endgame: false,\n    just_added: []\n  });\n  const [playerlistState, setplayerlistState] = useState([]);\n  const [analyticsdataState, setanalyticsdataState] = useState(analytics_data);\n  const [sachetState, setsachetState] = useState(new Sachet());\n  const playerlistRef = useRef(null);\n  const gamestateRef = useRef(null);\n  const boardstateRef = useRef(null);\n  const sachetstateRef = useRef(null);\n  playerlistRef.current = playerlistState;\n  gamestateRef.current = gameState;\n  boardstateRef.current = boardState;\n  sachetstateRef.current = sachetState;\n  useEffect(() => {\n    axios.get('http://localhost:5500/get_added_players', {\n      params: {\n        room_id: gameState.room_id,\n        username: profile.username\n      }\n    }).then(res => {\n      let sachet = { ...sachetstateRef.current\n      };\n      Object.setPrototypeOf(sachet, sachetstateRef.current);\n      console.log(\"INITIAL SACHETState\", sachetState);\n      console.log(\"INITIAL SACHET\", sachet);\n      let temp_player_list = [];\n\n      for (let i = 0; i < res.data.length; i++) {\n        let temp_player = new Player(res.data[i].Username);\n        temp_player.draw_by_tiles(res.data[i].Tiles);\n        sachet.remove_by_tiles(res.data[i].Tiles);\n        temp_player_list.push(temp_player);\n      }\n\n      const your_player = new Player(profile.username, true);\n      console.log(\"GAMES SACHET BEFORE\", sachet);\n      let drawn_tiles = your_player.draw(sachet);\n      your_player.tiles = drawn_tiles;\n      axios.put(\"http://localhost:5500/add_player\", {\n        username: your_player.username,\n        tiles: drawn_tiles,\n        room_id: gamestateRef.current.room_id\n      });\n      temp_player_list.push(your_player);\n      gamestateRef.current.socket.current.emit(\"emit_new_player\", {\n        username: your_player.username,\n        tiles: your_player.tiles,\n        room_id: gamestateRef.current.room_id\n      });\n      gamestateRef.current.socket.current.on(\"incoming_new_player\", res => {\n        let sachet2 = { ...sachetstateRef\n        };\n        Object.setPrototypeOf(sachet2, sachetstateRef.current);\n        let temp_player = new Player(res.username);\n        temp_player.draw_by_tiles(res.tiles);\n        sachet2.remove_by_tiles(res.tiles);\n        setgameState(prevgamestate => ({ ...prevgamestate,\n          player_num: prevgamestate.player_num + 1\n        }));\n        setplayerlistState(prevplayerlist => [...prevplayerlist, temp_player]);\n        setsachetState(sachet2);\n      });\n      setgameState(prevgamestate => ({ ...prevgamestate,\n        player_num: prevgamestate.player_num + temp_player_list.length,\n        your_index: temp_player_list.length - 1,\n        player_turn: prevgamestate.turn_num % (prevgamestate.player_num + temp_player_list.length)\n      }));\n      setplayerlistState(prevplayerlist => [...prevplayerlist, ...temp_player_list]);\n      setsachetState(sachet);\n      setrenderAction(true);\n      gamestateRef.current.socket.current.on(\"drop_tile_block\", socket_out => {\n        console.log(\"SOCKET OUT 2\");\n\n        if (socket_out.drag_container) {\n          setboardState(prevblockstate => ({ ...prevblockstate,\n            [socket_out.drop_block.index]: socket_out.drop_block\n          }));\n          setgameState(prevgamestate => ({ ...prevgamestate,\n            just_added: socket_out.just_added\n          }));\n          setplayerlistState(prevplayerlist => {\n            let temp_playerlist = [...prevplayerlist];\n            temp_playerlist[gamestateRef.current.player_turn].tiles = socket_out.drag_container;\n            return temp_playerlist;\n          });\n        } else {\n          setboardState(prevblockstate => ({ ...prevblockstate,\n            [socket_out.drag_block.index]: socket_out.drag_block,\n            [socket_out.drop_block.index]: socket_out.drop_block\n          }));\n          setgameState(prevgamestate => ({ ...prevgamestate,\n            just_added: socket_out.just_added\n          }));\n        }\n      });\n    });\n  }, []);\n  useEffect(() => {\n    setgameState(prevgamestate => ({ ...prevgamestate,\n      player_turn: prevgamestate.turn_num % prevgamestate.player_num\n    }));\n  }, [, gameState.turn_num]);\n  useEffect(() => {\n    setplayerlistState(prevplayerlist => {\n      let newplayerlist = [...prevplayerlist];\n\n      for (let i = 0; i < newplayerlist.length; i++) {\n        i == gameState.player_turn ? newplayerlist.active = true : newplayerlist.active = false;\n      }\n\n      return newplayerlist;\n    });\n  }, [gamestateRef.current.player_turn]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Games_page\",\n    children: [/*#__PURE__*/_jsxDEV(Joingame, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(SachetContext.Provider, {\n      value: {\n        sachetState,\n        setsachetState\n      },\n      children: /*#__PURE__*/_jsxDEV(AnalyticsDataContext.Provider, {\n        value: {\n          analyticsdataState,\n          setanalyticsdataState\n        },\n        children: /*#__PURE__*/_jsxDEV(GamesContext.Provider, {\n          value: {\n            gameState,\n            setgameState\n          },\n          children: /*#__PURE__*/_jsxDEV(PlayerListContext.Provider, {\n            value: {\n              playerlistState,\n              setplayerlistState\n            },\n            children: /*#__PURE__*/_jsxDEV(BlocksContext.Provider, {\n              value: {\n                boardState,\n                setboardState\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"Main_divider\",\n                children: [/*#__PURE__*/_jsxDEV(Alphabet_analytics, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(Main_game, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 156,\n                  columnNumber: 25\n                }, this), renderAction && /*#__PURE__*/_jsxDEV(Action_bar, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 157,\n                  columnNumber: 42\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 154,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 147,\n    columnNumber: 9\n  }, this);\n}\n/*<div className=\"Main_divider\">\r\n<Alphabet_analytics />\r\n<Main_game />\r\n{renderAction && <Action_bar />}\r\n</div> */\n\n\n_s(Gamespage, \"rBw91U1vIWd+Xmi1zQL2QPpEhfw=\", false, function () {\n  return [useParams];\n});\n\n_c = Gamespage;\nexport default Gamespage;\n\nvar _c;\n\n$RefreshReg$(_c, \"Gamespage\");","map":{"version":3,"sources":["C:/Users/TzeHaoTay/Desktop/CS/scrabble2/frontend/src/Games_page/Gamespage.js"],"names":["React","useState","useContext","useEffect","useRef","axios","Popup","UserContext","Player","Link","useParams","io","Joingame","Action_bar","Alphabet_analytics","Main_game","Sachet","analytics_data","GamesContext","BlocksContext","PlayerListContext","AnalyticsDataContext","SachetContext","Blocks","_","Gamespage","profile","setprofile","socketRef","current","connect","boardState","setboardState","renderAction","setrenderAction","gameState","setgameState","room_id","gamestarted","socket","turn_num","player_turn","player_num","your_index","endgame","just_added","playerlistState","setplayerlistState","analyticsdataState","setanalyticsdataState","sachetState","setsachetState","playerlistRef","gamestateRef","boardstateRef","sachetstateRef","get","params","username","then","res","sachet","Object","setPrototypeOf","console","log","temp_player_list","i","data","length","temp_player","Username","draw_by_tiles","Tiles","remove_by_tiles","push","your_player","drawn_tiles","draw","tiles","put","emit","on","sachet2","prevgamestate","prevplayerlist","socket_out","drag_container","prevblockstate","drop_block","index","temp_playerlist","drag_block","newplayerlist","active"],"mappings":"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","sourcesContent":["import './Gamespage.css';\r\nimport React, {useState,useContext,useEffect,useRef} from 'react';\r\nimport axios from 'axios';\r\nimport Popup from 'reactjs-popup';\r\nimport {UserContext} from '../UserContext.js';\r\nimport {Player} from './Player.js'\r\nimport {Link,useParams} from 'react-router-dom';\r\nimport io from 'socket.io-client';\r\nimport Joingame from './Main_game/Joingame.js'\r\nimport Action_bar from './Action/Actionbar.js'\r\nimport Alphabet_analytics from './Alphabet_analytics/Alphabet_analytics.js'\r\nimport Main_game from './Main_game/Main_game.js' \r\nimport Sachet, { analytics_data } from './Sachet.js'\r\nimport {GamesContext,BlocksContext,PlayerListContext,AnalyticsDataContext,SachetContext} from './GamesContext.js'\r\nimport {Blocks} from './Main_game/Board.js'\r\nimport _ from \"lodash\";\r\n\r\nfunction Gamespage() {\r\n    const {profile,setprofile}=useContext(UserContext)\r\n    const socketRef =useRef()\r\n    socketRef.current=io(\"http://localhost:5500\").connect()//.connect(\"http://localhost:5500\")\r\n    const [boardState,setboardState]=useState(new Blocks())\r\n    const [renderAction,setrenderAction]=useState(false)\r\n    const [gameState,setgameState]=useState({\r\n      room_id:useParams().room_id,\r\n      gamestarted:false,\r\n      socket:socketRef,\r\n      turn_num:0,\r\n      player_turn:0,\r\n      player_num:0, \r\n      your_index:0,\r\n      endgame:false,\r\n      just_added:[]\r\n    })\r\n    const [playerlistState,setplayerlistState]=useState([])\r\n    const [analyticsdataState,setanalyticsdataState]=useState(analytics_data)\r\n    const [sachetState,setsachetState]=useState(new Sachet())\r\n    \r\n    const playerlistRef=useRef(null);\r\n    const gamestateRef=useRef(null);\r\n    const boardstateRef=useRef(null);\r\n    const sachetstateRef=useRef(null);\r\n    playerlistRef.current=playerlistState\r\n    gamestateRef.current=gameState\r\n    boardstateRef.current=boardState\r\n    sachetstateRef.current=sachetState\r\n    useEffect(()=>{\r\n      \r\n      axios.get('http://localhost:5500/get_added_players',{params: {room_id:gameState.room_id,username:profile.username}}).then((res)=>{\r\n        let sachet={...sachetstateRef.current}\r\n        Object.setPrototypeOf( sachet,sachetstateRef.current )\r\n        console.log(\"INITIAL SACHETState\", sachetState)\r\n        console.log(\"INITIAL SACHET\", sachet)\r\n        let temp_player_list=[]\r\n        for (let i=0;i<res.data.length;i++){\r\n          let temp_player=new Player(res.data[i].Username)\r\n          temp_player.draw_by_tiles(res.data[i].Tiles)\r\n          sachet.remove_by_tiles(res.data[i].Tiles)\r\n          temp_player_list.push(temp_player)\r\n        }\r\n\r\n        const your_player=new Player(profile.username,true)\r\n        console.log(\"GAMES SACHET BEFORE\", sachet)\r\n        let drawn_tiles=your_player.draw(sachet)\r\n        your_player.tiles=drawn_tiles\r\n        axios.put(\"http://localhost:5500/add_player\",{\r\n          username:your_player.username,\r\n          tiles:drawn_tiles,\r\n          room_id:gamestateRef.current.room_id\r\n        })\r\n        temp_player_list.push(your_player)\r\n        \r\n        \r\n        gamestateRef.current.socket.current.emit(\"emit_new_player\",{\r\n          username:your_player.username,\r\n          tiles:your_player.tiles,\r\n          room_id:gamestateRef.current.room_id})\r\n        \r\n        gamestateRef.current.socket.current.on(\"incoming_new_player\", (res)=>{\r\n          let sachet2={...sachetstateRef}\r\n          Object.setPrototypeOf( sachet2,sachetstateRef.current )\r\n          let temp_player=new Player(res.username)\r\n          temp_player.draw_by_tiles(res.tiles)\r\n          sachet2.remove_by_tiles(res.tiles)\r\n          setgameState(prevgamestate=>({...prevgamestate,\r\n            player_num: prevgamestate.player_num+1\r\n          }))\r\n          setplayerlistState(prevplayerlist=>[...prevplayerlist,temp_player])\r\n          setsachetState(sachet2)\r\n        })\r\n\r\n        setgameState(prevgamestate=>({...prevgamestate,\r\n          player_num: prevgamestate.player_num+temp_player_list.length,\r\n          your_index:temp_player_list.length-1,\r\n          player_turn:prevgamestate.turn_num%(prevgamestate.player_num+temp_player_list.length)\r\n        }))\r\n        setplayerlistState(prevplayerlist=>[...prevplayerlist,...temp_player_list])\r\n        setsachetState(sachet)\r\n        setrenderAction(true)\r\n        gamestateRef.current.socket.current.on(\"drop_tile_block\",(socket_out)=>{\r\n          console.log(\"SOCKET OUT 2\")\r\n        if(socket_out.drag_container){\r\n          setboardState(prevblockstate=>({...prevblockstate,\r\n            [socket_out.drop_block.index]:socket_out.drop_block\r\n            }))\r\n          setgameState(prevgamestate=>({\r\n              ...prevgamestate,\r\n              just_added:socket_out.just_added,      \r\n          }))\r\n          setplayerlistState((prevplayerlist=>{\r\n              let temp_playerlist=[...prevplayerlist]\r\n              temp_playerlist[gamestateRef.current.player_turn].tiles=socket_out.drag_container\r\n              return temp_playerlist\r\n          }))\r\n        }else{\r\n          setboardState(prevblockstate=>({...prevblockstate,\r\n            [socket_out.drag_block.index]:socket_out.drag_block,\r\n            [socket_out.drop_block.index]:socket_out.drop_block\r\n            }))\r\n          setgameState(prevgamestate=>({\r\n            ...prevgamestate,\r\n            just_added:socket_out.just_added,      \r\n          }))\r\n        } \r\n    })\r\n    })},[])\r\n\r\n    useEffect(()=>{\r\n      setgameState( prevgamestate=>({...prevgamestate,\r\n      player_turn:prevgamestate.turn_num%prevgamestate.player_num\r\n    }))}\r\n    ,[,gameState.turn_num])\r\n    \r\n    useEffect(()=>{\r\n      setplayerlistState(prevplayerlist=>{\r\n        let newplayerlist=[...prevplayerlist]\r\n        for (let i=0;i<newplayerlist.length;i++){\r\n          (i==gameState.player_turn) ? newplayerlist.active=true : newplayerlist.active=false\r\n        }\r\n        return newplayerlist\r\n    })}\r\n    ,[gamestateRef.current.player_turn])\r\n\r\n    \r\n    \r\n      return (     \r\n        <div className=\"Games_page\">\r\n            <Joingame/>\r\n            <SachetContext.Provider value={{sachetState,setsachetState}}>\r\n              <AnalyticsDataContext.Provider value={{analyticsdataState,setanalyticsdataState}}>\r\n                <GamesContext.Provider value={{gameState,setgameState}}>\r\n                  <PlayerListContext.Provider value={{playerlistState,setplayerlistState}}>\r\n                    <BlocksContext.Provider value={{boardState,setboardState}}>\r\n                      <div className=\"Main_divider\">\r\n                        <Alphabet_analytics />\r\n                        <Main_game />\r\n                        {renderAction && <Action_bar />}\r\n                      </div> \r\n                    </BlocksContext.Provider>\r\n                  </PlayerListContext.Provider>   \r\n                </GamesContext.Provider>   \r\n              </AnalyticsDataContext.Provider>  \r\n              </SachetContext.Provider>                \r\n        </div>\r\n      );\r\n  }\r\n\r\n  /*<div className=\"Main_divider\">\r\n  <Alphabet_analytics />\r\n  <Main_game />\r\n  {renderAction && <Action_bar />}\r\n</div> */\r\n  \r\nexport default Gamespage;"]},"metadata":{},"sourceType":"module"}